# 📌 予約システム バックエンド技術スタック（Node.js + PostgreSQL）

本予約システムのバックエンドは、**Node.js + TypeScript** をベースに構築し、  
**スケーラブルでリアルタイム対応可能なアーキテクチャ** を採用する。  
また、データ管理の効率化のため、**リレーショナルDB（PostgreSQL）をメイン** にしつつ、  
**NoSQL（MongoDB, Redis）を補助的に活用** する。

---

## **1. コア技術スタック**
| 分類 | 採用技術 | 理由 |
|------|---------|------|
| **フレームワーク** | Fastify | 高速・スケーラブルなHTTPサーバー |
| **言語** | TypeScript | 型安全・開発効率向上 |
| **認証・認可** | Firebase Auth / OAuth2 / JWT | 安全なユーザー認証 |
| **データベース** | PostgreSQL | メインのリレーショナルDB |
| **NoSQL** | MongoDB | 予約履歴・対話ログの管理 |
| **キャッシュ** | Redis | 高速なリアルタイム処理 |
| **メッセージキュー** | BullMQ (Redis) | 非同期処理（通知・予約キャンセル処理） |
| **API設計** | GraphQL（Apollo Server）/ REST API | 柔軟なデータ取得 |

---

## **2. データベース構成**
| 分類 | 採用技術 | 理由 |
|------|---------|------|
| **リレーショナルDB (RDBMS)** | PostgreSQL | 予約・ユーザー・店舗データの管理 |
| **ドキュメントDB (NoSQL)** | MongoDB | 予約履歴・対話ログを管理 |
| **インメモリDB (キャッシュ)** | Redis | リアルタイム予約枠・対話ステート管理 |

### **🔹 データの分担**
| データ | 保存場所 | 理由 |
|--------|---------|------|
| **ユーザー・予約情報** | PostgreSQL | 一貫性・正規化が重要なデータ |
| **予約履歴・会話ログ** | MongoDB | スキーマの柔軟性・検索性を向上 |
| **リアルタイム予約枠** | Redis | 予約枠の即時検索・負荷軽減 |

---

## **3. API通信**
| 分類 | 採用技術 | 理由 |
|------|---------|------|
| **データ取得** | GraphQL (Apollo Server) | 柔軟なデータ取得・最適化 |
| **REST API** | Fastify REST API | シンプルなエンドポイント提供 |
| **リアルタイム通信** | WebSocket | 予約のリアルタイム更新 |
| **認証** | Firebase Auth / OAuth2 / JWT | Google・LINEログイン対応 |
| **決済** | Stripe API | 事前決済・キャンセル料処理 |
| **通知** | Twilio API / LINE API | SMS・LINEでの通知対応 |

---

## **4. 非同期処理**
| 項目 | 採用技術 | 理由 |
|------|---------|------|
| **予約リマインダー通知** | BullMQ（Redis） | 非同期ジョブ管理 |
| **キャンセル処理** | BullMQ | 指定時間後のキャンセル自動処理 |
| **バッチ処理** | Node.js Worker Threads | 負荷分散処理 |

---

## **5. ログ・監視**
| 項目 | 採用技術 | 理由 |
|------|---------|------|
| **ログ管理** | Winston / Elastic Stack | アクセス・エラーログ管理 |
| **モニタリング** | Prometheus / Grafana | APIパフォーマンス監視 |
| **エラートラッキング** | Sentry | バックエンドのエラーハンドリング |

---

## **6. セキュリティ**
| 項目 | 採用技術 | 理由 |
|------|---------|------|
| **認証** | JWT / OAuth2 | セキュアなユーザーログイン |
| **データ暗号化** | PostgreSQL AES Encryption | 個人情報保護 |
| **CSRF/XSS対策** | Helmet / CORS設定 | Webセキュリティ強化 |
| **RBAC（権限管理）** | Role-Based Access Control | 店舗ごとに管理者/スタッフ権限 |

---

## **7. デプロイ・CI/CD**
| 項目 | 採用技術 | 理由 |
|------|---------|------|
| **クラウドプラットフォーム** | AWS / Google Cloud | スケーラブルなインフラ |
| **コンテナ化** | Docker + Kubernetes | マイクロサービス対応 |
| **CI/CD** | GitHub Actions | 自動テスト・デプロイ |
| **APIゲートウェイ** | Nginx / AWS API Gateway | 負荷分散・セキュリティ強化 |

---

## **8. まとめ**
この技術スタックを採用することで、**スケーラブル・リアルタイム対応・セキュアなバックエンド** を実現する。  
特に **GraphQL・WebSocket・Redis・BullMQ** を活用し、**業種を問わず拡張可能な予約システム** を構築する。

